---
title: "Hmisc Examples"
author: "FE Harrell"
date: '`r Sys.Date()`'
output:
  html_notebook:
    toc: yes
    toc_float:
      collapsed: yes
  html_document:
    toc: yes
---
# Introduction
This is a set of reproducible examples put together in an `rmarkdown` notebook using `RStudio` and `knitr`..  When viewing the resulting [html file](http://data.vanderbilt.edu/fh/R/Hmisc/examples.nb.html) you can see all the code, and can download the entire `rmarkdown` script, which is especially helpful for seeing how `knitr` chunks are specified.  Graphics that have a [plotly](http://plot.ly/r) method for them are rendered using `plotly` instead of using defaults such as base graphics, `lattice`, or `ggplot2`.  That way the plots are somewhat interactive, e.g., allow for drill-down for more information without the viewer needing to install `R`.

Much of the tabular output produced here was created using `html` methods, which are especially easy to implement with `rmarkdown` and make for output that can be directly opened using word processors.

Static graphics are in `png` format.

# Setup
```{r setup}
require(Hmisc)
knitrSet(lang='markdown', h=5.5, w=7)
options(grType='plotly') # for certain graphics functions
mu <- markupSpecs$html   # markupSpecs is in Hmisc
subtext <- mu$subtext
code    <- mu$code
```

# Fetching Data, Modifying Variables, and Printing Data Dictionary
The `getHdata` function is used to fetch a dataset from the Vanderbilt `DataSets` web site.  `contents` is used to print a data dictionary, run through an `html` method for nicer output.  
```{r metadata,results='asis'}
getHdata(pbc)
# Have upData move units from labels to separate attribute
pbc <- upData(pbc,
              fu.yrs = fu.days / 365.25,
              labels = c(fu.yrs = 'Follow-up Time',
                         status = 'Death or Liver Transplantation'),
              units = c(fu.yrs = 'year'),
              drop  = 'fu.days',
              moveUnits=TRUE, html=TRUE)
h <- html(contents(pbc), file='', maxlevels=10, levelType='table')
```
# Descriptive Statistics Without Stratification
The `latexVerbatim` function is used to enclose output of `describe` in an html box with a smaller font.
```{r describe}
d <- describe(pbc)
htmlVerbatim(d, size=60)
plot(d)
```

# Stratified Descriptive Statistics
```{r summaryM,fig.height=6}
s <- summaryM(bili + albumin + stage + protime + sex + age + spiders +
              alk.phos + sgot + chol ~ drug, data=pbc,
							overall=FALSE, test=TRUE)
plot(s, which='categorical')
plot(s, which='continuous')
```

```{r summaryM3}
html(s, caption='Baseline characteristics by randomized treatment',
     exclude1=TRUE, npct='both', digits=3,
     prmsd=TRUE, brmsd=TRUE, msdsize=mu$smaller2)
```

# Computing Environment
`r mu$session()`
